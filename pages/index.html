<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>index</title>
  </head>
  <body>
    <section class="section">
      <div class="container">
        <div class="wrapper cover-wrapper">
          <div class="row">
            <div class="col-md-6 col-12">
              <div class="d-flex flex-column">
                <img
                  src="https://raw.githubusercontent.com/hexschool/2022-web-layout-training/refs/heads/main/js_week5/main_img.png"
                  class="mb-5"
                />
                <img
                  src="https://raw.githubusercontent.com/hexschool/2022-web-layout-training/refs/heads/main/js_week5/logo.png"
                  class="d-none d-sm-block"
                />
              </div>
            </div>
            <div class="col-md-6 col-12">
              <h1 class="form-title">
                <i class="bi bi-plus-circle"></i>新增旅遊套票
              </h1>
              <form action="" id="ticketAddForm">
                <div class="d-flex mb-4">
                  <label for="ticketName" class="form-label">套票名稱</label>
                  <input
                    type="text"
                    class="form-control form-custom w-100"
                    id="ticketName"
                    placeholder="請填寫套票名稱"
                  />
                </div>
                <div class="d-flex mb-4">
                  <label for="ticketImgUrl" class="form-label">圖片網址</label>
                  <input
                    type="text"
                    class="form-control form-custom w-100"
                    id="ticketImgUrl"
                    placeholder="請填寫圖片網址"
                  />
                </div>
                <div class="d-flex mb-4">
                  <label for="ticketRegion" class="form-label">景點地區</label>
                  <select
                    class="form-control form-custom form-select form-secondary  w-100"
                    id="ticketRegion"
                  >
                    <option value="" selected>請選擇景點地區</option>
                    <option value="台北">台北</option>
                    <option value="台中">台中</option>
                    <option value="高雄">高雄</option>
                  </select>
                </div>
                <div class="d-flex mb-4">
                  <label for="ticketPrice" class="form-label">套票金額</label>
                  <input
                    type="number"
                    class="form-control form-custom w-100"
                    id="ticketPrice"
                    placeholder="請填寫套票金額"
                  />
                </div>
                <div class="d-flex mb-4">
                  <label for="ticketSetNum" class="form-label">套票組數</label>
                  <input
                    type="number"
                    class="form-control form-custom w-100"
                    id="ticketSetNum"
                    placeholder="請填寫套票組數"
                  />
                </div>
                <div class="d-flex mb-4">
                  <label for="ticketRank" class="form-label">套票星級</label>
                  <input
                    type="number"
                    class="form-control form-custom w-100"
                    id="ticketRank"
                    placeholder="請填寫套票星級"
                  />
                </div>
                <div class="d-flex mb-6">
                  <label for="ticketDescription" class="form-label"
                    >套票描述</label
                  >
                  <textarea
                    class="form-control form-custom w-100"
                    placeholder="請填寫套票描述（限 100 字）"
                    id="ticketDescription"
                    style="height: 111px;"
                  ></textarea>
                </div>
                <div class="d-flex">
                  <button
                    type="button"
                    class="btn btn-primary ms-auto"
                    id="addTicket"
                  >
                    新增套票
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>
    <main class="main">
      <div class="container">
        <div class="wrapper d-flex align-items-center flex-wrap gap-4">
          <select
            class="form-control form-select form-secondary filter-select"
            id="filterRegion"
          >
            <option value="" selected>請選擇景點地區</option>
            <option value="台北">台北</option>
            <option value="台中">台中</option>
            <option value="高雄">高雄</option>
            <option value="花蓮">花蓮</option>
          </select>
          <p id="filterNums" class="text-secondary">本次搜尋共 6 筆資料</p>
        </div>
        <ul class="row row-gap-8 mt-12" id="ticketDisplay">
          <!-- <li class="col-12 col-sm-6 col-lg-4">
            <div class="roundImgCard">
              <img
                src="https://github.com/hexschool/2022-web-layout-training/blob/main/js_week5/travel_1.png?raw=true"
                alt=""
              />
              <p class="card-badge badge-primary-100">台北</p>
              <div class="card-body">
                <p class="card-badge-sm badge-primary">8.6</p>
                <h3 class="card-title">綠島自由行套裝行程</h3>
                <p class="card-content">
                  嚴選超高CP值綠島自由行套裝行程，多種綠島套裝組合，提供台東綠島來回船票、綠島環島機車、綠島民宿住宿，行程加贈『綠島浮潛體驗』以及『綠島生態導覽』，讓你用輕鬆的綠島套裝自由行，也能深度認識綠島在地文化。
                </p>
                <div class="card-info">
                  <p>
                    <i class="bi bi-exclamation-circle-fill"></i>剩下最後 8 組
                  </p>
                  <p class="infoPrice">
                    TWD<span class="highlight">$1,280</span>
                  </p>
                </div>
              </div>
            </div>
          </li> -->
          <!-- <li class="col-12 col-sm-6 col-lg-4">
            <div class="roundImgCard">
              <img
                src="https://github.com/hexschool/2022-web-layout-training/blob/main/js_week5/travel_1.png?raw=true"
                alt=""
              />
              <p class="card-badge badge-primary-100">台北</p>
              <div class="card-body">
                <p class="card-badge-sm badge-primary">8.6</p>
                <h3 class="card-title">綠島自由行套裝行程</h3>
                <p class="card-content">
                  嚴選超高CP值綠島自由行套裝行程，多種綠島套裝組合，提供台東綠島來回船票、綠島環島機車、
                </p>
                <div class="card-info">
                  <p>
                    <i class="bi bi-exclamation-circle-fill"></i>剩下最後 8 組
                  </p>
                  <p class="infoPrice">
                    TWD<span class="highlight">$1,280</span>
                  </p>
                </div>
              </div>
            </div>
          </li> -->
          <!-- <li class="col-12 col-sm-6 col-lg-4">
            <div class="roundImgCard">
              <img
                src="https://github.com/hexschool/2022-web-layout-training/blob/main/js_week5/travel_1.png?raw=true"
                alt=""
              />
              <p class="card-badge badge-primary-100">台北</p>
              <div class="card-body">
                <p class="card-badge-sm badge-primary">8.6</p>
                <h3 class="card-title">綠島自由行套裝行程</h3>
                <p class="card-content">
                  嚴選超高CP值綠島自由行套裝行程，多種綠島套裝組合，提供台東綠島來回船票、綠島環島機車、綠島民宿住宿，行程加贈『綠島浮潛體驗』以及『綠島生態導覽』，讓你用輕鬆的綠島套裝自由行，也能深度認識綠島在地文化。
                </p>
                <div class="card-info">
                  <p>
                    <i class="bi bi-exclamation-circle-fill"></i>剩下最後 8 組
                  </p>
                  <p class="infoPrice">
                    TWD<span class="highlight">$1,280</span>
                  </p>
                </div>
              </div>
            </div>
          </li> -->
        </ul>
        <div class="cantFind-area mt-12">
          <!-- <p class="contentMsg">查無此關鍵字資料</p> -->
          <img
            src="https://github.com/hexschool/2022-web-layout-training/blob/main/js_week5/no_found.png?raw=true"
            alt=""
          />
        </div>
      </div>
    </main>
    <script type="module" src="../main.js"></script>
    <script type="module">
      import axios from 'axios';
      // console.log(axios);
      const ticketForm = document.querySelector('#ticketAddForm');
      const ticketName = document.querySelector('#ticketName');
      const ticketImgUrl = document.querySelector('#ticketImgUrl');
      const ticketPrice = document.querySelector('#ticketPrice');
      const ticketRegion = document.querySelector('#ticketRegion');
      const ticketSetNum = document.querySelector('#ticketSetNum');
      const ticketRank = document.querySelector('#ticketRank');
      const ticketDescription = document.querySelector('#ticketDescription');
      const addTicket = document.querySelector('#addTicket');

      const filterRegion = document.querySelector('#filterRegion');
      const filterNums = document.querySelector('#filterNums');
      const ticketDisplay = document.querySelector('#ticketDisplay');
      const ticketLink = document.querySelectorAll('.ticket-link');
      const cantFindArea = document.querySelector('.cantFind-area');

      const dataUrl1='https://raw.githubusercontent.com/hexschool/js-training/main/travelAPI-lv1.json';
      const dataUrl2='https://raw.githubusercontent.com/hexschool/js-training/main/travelApi.json';
      let ticketsData=new Array;


      const init=()=>{
        loadData();
      };

      // getData
      const loadData=()=>{
        axios.get(dataUrl2).then((response)=>{
          // console.log(response);
          ticketsData=response.data.data;
          // console.log(ticketsData);
          renderTicket(ticketsData);
        }).catch((error)=>{
          renderTicket(ticketsData);
          // console.log(error);
          window.alert(`${error.response.data}`)
        })
      }

      //card內容
      const ticketCard = (ticketData) => {
            // const ticketDisplay = document.querySelector('#ticketDisplay');
            ticketDisplay.innerHTML = '';
            ticketData.forEach(item => {
                const ticketList = document.createElement('li');
                ticketList.className = 'col-12 col-sm-6 col-lg-4';

                const ticketCard = document.createElement('div');
                ticketCard.className = 'roundImgCard';
                const ticketLink = document.createElement('a');
                ticketLink.href = '#';
                ticketLink.className = 'ticket-link';

                const cardImg = document.createElement('img');
                cardImg.src = item.imgUrl;
                const imgBadge = document.createElement('p');
                imgBadge.className = 'card-badge badge-primary-100';
                imgBadge.textContent = item.area;

                const cardBody = document.createElement('div');
                cardBody.className = 'card-body';
                const cardBodyBadge = document.createElement('p');
                cardBodyBadge.className = 'card-badge-sm badge-primary';
                cardBodyBadge.textContent = item.rate;
                const cardTitle = document.createElement('h3');
                cardTitle.className = 'card-title';
                cardTitle.textContent = item.name;
                const cardContent = document.createElement('p');
                cardContent.textContent = item.description;

                const cardInfo = document.createElement('div');
                cardInfo.className = 'card-info';
                const groupInfo = document.createElement('p');
                const groupNoneHtml = `<i class="bi bi-exclamation-circle-fill"></i>限時搶購`;
                const groupLeftHtml = `<i class="bi bi-exclamation-circle-fill"></i>剩下最後 ${item.group} 組`;
                groupInfo.innerHTML = (item.group == 0) ? groupNoneHtml : groupLeftHtml;
                const ticketInfo = document.createElement('p');
                ticketInfo.className = 'infoPrice';
                ticketInfo.innerHTML = `TWD<span class="highlight">$${item.price}</span>`;

                cardInfo.appendChild(groupInfo);
                cardInfo.appendChild(ticketInfo);

                cardBody.appendChild(cardBodyBadge);
                cardBody.appendChild(cardTitle);
                cardBody.appendChild(cardContent);
                cardBody.appendChild(cardInfo);

                ticketLink.appendChild(cardImg);
                ticketCard.appendChild(ticketLink);
                ticketCard.appendChild(imgBadge);
                ticketCard.appendChild(cardBody);

                ticketList.appendChild(ticketCard);
                // console.log(ticketList);
                ticketDisplay.appendChild(ticketList);
              });
      };

      //渲染
      const renderTicket = (ticketData) => {
            let dataNum = ticketData.length;
            if (dataNum !== 0) {
              filterNums.textContent = `本次搜尋共 ${dataNum} 筆資料`;
              cantFindArea.style.display = 'none';
              ticketDisplay.style.display = 'flex';
            ticketCard(ticketData);
            } else {
              filterNums.textContent = `查無此關鍵字資料`;
              ticketDisplay.style.display = 'none';
              cantFindArea.style.display = 'block';
              }
      };

      //監聽
      addTicket.addEventListener('click', () => {
        let newTicket = new Object;
        let errorMsg = '';
        let lastIndex=ticketsData.length-1;
        newTicket.id = Number(ticketsData[lastIndex].id)+1;
        newTicket.name = ticketName.value.trim();
        newTicket.imgUrl = ticketImgUrl.value.trim();
        newTicket.area = ticketRegion.value.trim();
        newTicket.description = ticketDescription.value.trim();
        newTicket.group = ticketSetNum.value.trim();
        newTicket.price = ticketPrice.value.trim();
        newTicket.rate = ticketRank.value.trim();
        if (!newTicket.name) {
            errorMsg = '套票名稱為必填!';
        } else if (!newTicket.imgUrl) {
            errorMsg = '圖片網址為必填!';
        } else if (!newTicket.area) {
            errorMsg = '請選擇地區!';
        } else if (newTicket.price <= 0) {
            errorMsg = '套票金額必須大於 0!';
            ticketPrice.value = '';
        } else if (newTicket.group < 0) {
            errorMsg = '套票組數必須大於等於0!';
            ticketSetNum.value = '';
        } else if (newTicket.rate < 1 || newTicket.rate > 10) {
            errorMsg = '套票星級必須在 1 至 10 之間!';
            ticketRank.value = '';
        } else if (newTicket.description > 100 || !newTicket.description) {
            errorMsg = '套票描述必填，且不能超過 100 字!';
        }
        if (errorMsg) {
            window.alert(errorMsg);
            return;
        } else {
            window.alert('新增成功');
        }
        ticketsData.push(newTicket);
        // console.log(data);
        ticketForm.reset();
        filterRegion.value = '';
        renderTicket(ticketsData);
      });

      filterRegion.addEventListener('change', () => {
        let filterData = new Array;
        // let AreaData = ['台北', '台中', '高雄', '花蓮'];
        // console.log(filterRegion.value);
        if(!filterRegion.value){
          renderTicket(ticketsData);
        }else{
          filterData=ticketsData.filter(ticketData=>ticketData.area===filterRegion.value);
          renderTicket(filterData);
        }
      });

      ticketDisplay.addEventListener('click',e=>{
        e.preventDefault();
      });


      init();
    </script>
  </body>
</html>
